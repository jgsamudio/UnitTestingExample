class CredentialValidator {

    func isValid(email: String) -> Bool {
        return email.contains("@") &&
            email.count > 5
    }

    func isValid(password: String) -> Bool {
        return password.count > 3
    }

}

//////////////////////////////////////////////////////

import XCTest
@testable import UnitTesting

class ViewModelTests: XCTestCase {

    var sut: ViewModel!
    var networkProvider: MockNetworkProvider!
    var delegate: MockViewDelegate!

    override func setUp() {
        networkProvider = MockNetworkProvider()
        sut = ViewModel(networkProvider: networkProvider)

        delegate = MockViewDelegate()
        sut.delegate = delegate
    }

    func testLoginUser_ValidCredentials_AtSymbolAndCount() {
        // Given
        sut.email = "stanleiscool@stanleiscool.com"
        sut.password = "coolerthantherest"

        // When
        sut.loginUser()

        // Then
        XCTAssertTrue(networkProvider.loginUserWasCalled)
        XCTAssertEqual(networkProvider.email, sut.email)
        XCTAssertEqual(networkProvider.password, sut.password)

        XCTAssertTrue(delegate.hideErrorWasCalled)
        XCTAssertFalse(delegate.displayErrorWasCalled)
    }

    func testLoginUser_InvalidCredentials_Email_LowCount() {
        // Given
        sut.email = "@"
        sut.password = "coolerthantherest"

        // When
        sut.loginUser()

        // Then
        XCTAssertFalse(networkProvider.loginUserWasCalled)
        XCTAssertFalse(delegate.hideErrorWasCalled)

        XCTAssertTrue(delegate.displayErrorWasCalled)
        XCTAssertEqual(delegate.error, "Email or Password is incorrect.")
    }

    func testLoginUser_InvalidCredentials_Email_MissingAtSymbol() {
        // Given
        sut.email = "stanleiscool.com"
        sut.password = "coolerthantherest"

        // When
        sut.loginUser()

        // Then
        XCTAssertFalse(networkProvider.loginUserWasCalled)
        XCTAssertFalse(delegate.hideErrorWasCalled)

        XCTAssertTrue(delegate.displayErrorWasCalled)
        XCTAssertEqual(delegate.error, "Email or Password is incorrect.")
    }

    func testLoginUser_InvalidCredentials_Password_LowCount() {
        // Given
        sut.email = "stanleiscool@stanleiscool.com"
        sut.password = "hi"

        // When
        sut.loginUser()

        // Then
        XCTAssertFalse(networkProvider.loginUserWasCalled)
        XCTAssertFalse(delegate.hideErrorWasCalled)

        XCTAssertTrue(delegate.displayErrorWasCalled)
        XCTAssertEqual(delegate.error, "Email or Password is incorrect.")    }
}


////////////////////////////////////////////////////////////////////////

import Foundation
@testable import UnitTesting

class MockViewDelegate: ViewDelegate {

    var displayErrorWasCalled = false
    var hideErrorWasCalled = false
    var error = ""

    func display(error: String) {
        displayErrorWasCalled = true
        self.error = error
    }

    func hideError() {
        hideErrorWasCalled = true
    }

}

////////////////////////////////////////////////////////////////////////


import Foundation
@testable import UnitTesting

class MockNetworkProvider: NetworkProvider {

    var loginUserWasCalled = false
    var email = ""
    var password = ""

    func loginUser(email: String, password: String) {
        loginUserWasCalled = true
        self.email = email
        self.password = password
    }

}

